(()=>{var e={};e.id=386,e.ids=[386],e.modules={62849:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=62849,e.exports=t},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},14300:e=>{"use strict";e.exports=require("buffer")},6113:e=>{"use strict";e.exports=require("crypto")},82361:e=>{"use strict";e.exports=require("events")},41808:e=>{"use strict";e.exports=require("net")},77282:e=>{"use strict";e.exports=require("process")},12781:e=>{"use strict";e.exports=require("stream")},71576:e=>{"use strict";e.exports=require("string_decoder")},39512:e=>{"use strict";e.exports=require("timers")},24404:e=>{"use strict";e.exports=require("tls")},57310:e=>{"use strict";e.exports=require("url")},73837:e=>{"use strict";e.exports=require("util")},59796:e=>{"use strict";e.exports=require("zlib")},45285:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>v,patchFetch:()=>x,requestAsyncStorage:()=>E,routeModule:()=>l,serverHooks:()=>m,staticGenerationAsyncStorage:()=>_});var s={};r.r(s),r.d(s,{POST:()=>p,dynamic:()=>d,runtime:()=>u});var i=r(49303),a=r(88716),o=r(60670),n=r(87070),c=r(16385);let u="nodejs",d="force-dynamic";async function p(e,{params:t}){let r=Number(t.id),{item_id:s,month_index:i,date:a}=await e.json();if(!s||!i)return n.NextResponse.json({error:"item_id e month_index s\xe3o obrigat\xf3rios"},{status:400});let o=await (0,c.V)(),[[u]]=await o.execute("SELECT * FROM contracts WHERE id=?",[r]),[[d]]=await o.execute("SELECT * FROM contract_items WHERE id=? AND contract_id=?",[s,r]);if(!u||!d)return await o.end(),n.NextResponse.json({error:"Contrato/Item inv\xe1lido"},{status:400});let p=new Date(function(e,t){let r=new Date(e);return r.setMonth(r.getMonth()+t),r.toISOString().slice(0,10)}(u.start_date,i-1)),l=new Date(p.getFullYear(),p.getMonth(),1).toISOString().slice(0,10),E=new Date(p.getFullYear(),p.getMonth()+1,0).toISOString().slice(0,10),[_]=await o.execute("SELECT * FROM activities WHERE created_from='CONTRATO' AND related_id=? AND DATE(start_datetime) BETWEEN ? AND ? LIMIT 1",[s,l,E]);if(a){if(_[0])await o.execute("UPDATE activities SET start_datetime=? WHERE id=?",[`${a} 09:00:00`,_[0].id]);else{let[[e]]=await o.execute("SELECT s.name FROM services s JOIN contract_items ci ON ci.service_id=s.id WHERE ci.id=?",[s]);await o.execute("INSERT INTO activities (title, company_id, service_id, assigned_user_id, start_datetime, status, created_from, related_id) VALUES (?,?,?,?,?, 'PENDENTE','CONTRATO',?)",[`${e?.name||"Servi\xe7o"} — Contrato #${r}`,u.company_id,d.service_id,null,`${a} 09:00:00`,s])}}else _[0]&&await o.execute("DELETE FROM activities WHERE id=?",[_[0].id]);return await o.end(),n.NextResponse.json({ok:!0})}let l=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/contracts/[id]/plan/route",pathname:"/api/contracts/[id]/plan",filename:"route",bundlePath:"app/api/contracts/[id]/plan/route"},resolvedPagePath:"C:\\Users\\felipe\\Desktop\\agora\\src\\app\\api\\contracts\\[id]\\plan\\route.js",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:E,staticGenerationAsyncStorage:_,serverHooks:m}=l,v="/api/contracts/[id]/plan/route";function x(){return(0,o.patchFetch)({serverHooks:m,staticGenerationAsyncStorage:_})}},16385:(e,t,r)=>{"use strict";r.d(t,{V:()=>i});var s=r(69518);async function i(){if(!process.env.DB_HOST||!process.env.DB_USER||!process.env.DB_NAME)throw Error("Database env vars missing (DB_HOST, DB_USER, DB_NAME). Configure on Vercel Project Settings → Environment Variables.");return await s.createConnection({host:process.env.DB_HOST,port:process.env.DB_PORT||3306,user:process.env.DB_USER,password:process.env.DB_PASS,database:process.env.DB_NAME,charset:"utf8mb4"})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,827,972],()=>r(45285));module.exports=s})();