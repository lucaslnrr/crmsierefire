(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[460],{6069:function(e,a,s){Promise.resolve().then(s.bind(s,7402))},7402:function(e,a,s){"use strict";s.r(a),s.d(a,{default:function(){return i}});var t=s(7437),n=s(2265);function i(e){var a;let{params:s}=e,i=s.id,[l,d]=(0,n.useState)(null),[c,r]=(0,n.useState)([]),[o,m]=(0,n.useState)({event_type:"EXECUTED",event_time:"",performed_by:"",notes:"",evidence_url:"",new_datetime:""}),[v,h]=(0,n.useState)("");async function x(){let[e,a]=await Promise.all([fetch("/api/activities/".concat(i)),fetch("/api/users")]);d(await e.json()),r(await a.json()),m(e=>({...e,event_time:new Date().toISOString().slice(0,16)}))}async function u(e){e.preventDefault(),h("");let a={...o};a.event_time=a.event_time.replace("T"," ")+":00",a.new_datetime&&(a.new_datetime=a.new_datetime.replace("T"," ")+":00"),(await fetch("/api/activities/".concat(i,"/events"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)})).ok?(h("Evento registrado."),await x()):h("Falha ao salvar.")}if((0,n.useEffect)(()=>{x()},[i]),!l)return(0,t.jsx)("div",{children:"Carregando..."});let j=l.events.find(e=>"EXECUTED"===e.event_type);return(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("h1",{className:"text-2xl font-semibold",children:["Atividade #",l.activity.id]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsxs)("div",{className:"grid md:grid-cols-3 gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"hdr",children:"T\xedtulo"}),(0,t.jsx)("div",{children:l.activity.title})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"hdr",children:"Cliente"}),(0,t.jsx)("div",{children:(null===(a=l.company)||void 0===a?void 0:a.nome)||"—"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"hdr",children:"Prevista"}),(0,t.jsx)("div",{children:new Date(l.activity.start_datetime).toLocaleString("pt-BR")})]})]}),(0,t.jsx)("div",{className:"mt-2",children:j?(0,t.jsxs)("span",{className:"badge-ok",children:["Executada em ",new Date(j.event_time).toLocaleString("pt-BR")]}):(0,t.jsx)("span",{className:"badge-warn",children:"Sem execu\xe7\xe3o registrada"})})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h2",{className:"font-semibold mb-2",children:"Adicionar Evento"}),(0,t.jsxs)("form",{onSubmit:u,className:"grid md:grid-cols-2 gap-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"hdr",children:"Tipo"}),(0,t.jsxs)("select",{className:"select",value:o.event_type,onChange:e=>m({...o,event_type:e.target.value}),children:[(0,t.jsx)("option",{value:"EXECUTED",children:"EXECUTED (conclui)"}),(0,t.jsx)("option",{value:"RESCHEDULED",children:"RESCHEDULED (remarca)"}),(0,t.jsx)("option",{value:"CANCELED",children:"CANCELED"}),(0,t.jsx)("option",{value:"NO_SHOW",children:"NO_SHOW"}),(0,t.jsx)("option",{value:"NOTE",children:"NOTE"})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"hdr",children:"Data/Hora do evento"}),(0,t.jsx)("input",{className:"input",type:"datetime-local",value:o.event_time,onChange:e=>m({...o,event_time:e.target.value})})]}),"RESCHEDULED"===o.event_type&&(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("label",{className:"hdr",children:"Nova data/hora (aplica na agenda)"}),(0,t.jsx)("input",{className:"input",type:"datetime-local",value:o.new_datetime,onChange:e=>m({...o,new_datetime:e.target.value})})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"hdr",children:"Executado por"}),(0,t.jsxs)("select",{className:"select",value:o.performed_by,onChange:e=>m({...o,performed_by:e.target.value}),children:[(0,t.jsx)("option",{value:"",children:"—"}),c.map(e=>(0,t.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)("label",{className:"hdr",children:"Evid\xeancia (URL)"}),(0,t.jsx)("input",{className:"input",placeholder:"https://...",value:o.evidence_url,onChange:e=>m({...o,evidence_url:e.target.value})})]}),(0,t.jsxs)("div",{className:"md:col-span-2",children:[(0,t.jsx)("label",{className:"hdr",children:"Observa\xe7\xf5es"}),(0,t.jsx)("textarea",{className:"textarea",rows:4,value:o.notes,onChange:e=>m({...o,notes:e.target.value})})]}),(0,t.jsx)("div",{className:"md:col-span-2",children:(0,t.jsx)("button",{className:"btn",children:"Salvar"})}),v&&(0,t.jsx)("div",{className:"text-sm text-green-700",children:v})]})]}),(0,t.jsxs)("div",{className:"card",children:[(0,t.jsx)("h2",{className:"font-semibold mb-2",children:"Timeline"}),0===l.events.length?(0,t.jsx)("div",{className:"text-sm text-gray-500",children:"Nenhum evento ainda."}):(0,t.jsx)("ul",{className:"space-y-2",children:l.events.map(e=>(0,t.jsxs)("li",{className:"border rounded-xl p-2 text-sm",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("b",{children:e.event_type})," • ",new Date(e.event_time).toLocaleString("pt-BR")]}),e.new_datetime&&(0,t.jsxs)("span",{className:"badge-info",children:["Remarcado p/ ",new Date(e.new_datetime).toLocaleString("pt-BR")]})]}),(0,t.jsxs)("div",{className:"text-gray-600",children:["Por: ",e.performed_by_name||"—"]}),e.notes&&(0,t.jsxs)("div",{className:"text-gray-700",children:["Obs.: ",e.notes]}),e.evidence_url&&(0,t.jsx)("a",{className:"text-blue-600 underline",href:e.evidence_url,target:"_blank",children:"Evid\xeancia"})]},e.id))})]})]})}}},function(e){e.O(0,[971,23,744],function(){return e(e.s=6069)}),_N_E=e.O()}]);