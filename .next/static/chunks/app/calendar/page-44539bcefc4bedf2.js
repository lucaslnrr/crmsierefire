(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[329],{3123:function(e,t,a){Promise.resolve().then(a.bind(a,2280))},2280:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return d}});var s=a(7437),n=a(2265);function l(e){return e instanceof Date?e:new Date(e)}function i(e){let t=l(e);return!t||isNaN(t)?"":t.toISOString().slice(0,10)}function c(e){let t=l(e);return!t||isNaN(t)?"":t.toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}function r(e){if(null==e)return"";let t=String(e).replaceAll('"','""');return/[",\n]/.test(t)?'"'+t+'"':t}function d(){let[e,t]=(0,n.useState)([]),[a,d]=(0,n.useState)([]),[o,m]=(0,n.useState)(""),[h,u]=(0,n.useState)(""),[x,p]=(0,n.useState)(""),[j,N]=(0,n.useState)("WEEK"),[g,f]=(0,n.useState)(new Date),v=(0,n.useMemo)(()=>(function(e){let t=new Date(e),a=t.getDay(),s=new Date(t);return s.setDate(t.getDate()-(a+6)%7),[...Array(7)].map((e,t)=>{let a=new Date(s);return a.setDate(s.getDate()+t),a})})(g),[g]),D=(0,n.useMemo)(()=>(function(e){let t=new Date(e),a=new Date(new Date(t.getFullYear(),t.getMonth(),1)),s=(a.getDay()+6)%7;return a.setDate(a.getDate()-s),[...Array(42)].map((e,t)=>{let s=new Date(a);return s.setDate(a.getDate()+t),s})})(g),[g]),b=(0,n.useMemo)(()=>"WEEK"===j?{start:v[0],end:v[6]}:"MONTH"===j?{start:D[0],end:D[41]}:{start:new Date(g.getFullYear(),g.getMonth(),1),end:new Date(g.getFullYear(),g.getMonth()+1,0)},[j,g,v,D]);async function S(){let e=new URLSearchParams;e.set("start",i(b.start)),e.set("end",i(b.end)),o&&e.set("assigned_user_id",o),h&&e.set("status",h),x&&e.set("doc",x);let[a,s]=await Promise.all([fetch("/api/users"),fetch("/api/activities?"+e.toString())]);t(await a.json()),d(await s.json())}(0,n.useEffect)(()=>{S()},[o,h,x,j,g]);let w=(0,n.useMemo)(()=>{let e={};for(let s of a){var t;let a=i(s.start_datetime);(null!==(t=e[a])&&void 0!==t?t:e[a]=[]).push(s)}return e},[a]);return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)("h1",{className:"text-2xl font-semibold",children:"Calend\xe1rio"}),(0,s.jsxs)("div",{className:"card grid md:grid-cols-4 gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"hdr",children:"Profissional"}),(0,s.jsxs)("select",{className:"select",value:o,onChange:e=>m(e.target.value),children:[(0,s.jsx)("option",{value:"",children:"Todos"}),e.map(e=>(0,s.jsx)("option",{value:e.id,children:e.name},e.id))]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"hdr",children:"Status"}),(0,s.jsxs)("select",{className:"select",value:h,onChange:e=>u(e.target.value),children:[(0,s.jsx)("option",{value:"",children:"Todos"}),(0,s.jsx)("option",{value:"PENDENTE",children:"Pendente"}),(0,s.jsx)("option",{value:"EM_ATRASO",children:"Em atraso"}),(0,s.jsx)("option",{value:"CONCLUIDA",children:"Conclu\xedda"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"hdr",children:"CNPJ/CPF/CAEPF"}),(0,s.jsx)("input",{className:"input",placeholder:"Documento",value:x,onChange:e=>p(e.target.value)})]}),(0,s.jsxs)("div",{className:"flex items-end gap-2",children:[(0,s.jsx)("button",{className:"btn ".concat("WEEK"===j?"":"opacity-70"),onClick:()=>N("WEEK"),children:"Semana"}),(0,s.jsx)("button",{className:"btn ".concat("MONTH"===j?"":"opacity-70"),onClick:()=>N("MONTH"),children:"M\xeas"}),(0,s.jsx)("button",{className:"btn ".concat("LIST"===j?"":"opacity-70"),onClick:()=>N("LIST"),children:"Lista"})]}),(0,s.jsxs)("div",{className:"md:col-span-4 flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)("button",{className:"btn",onClick:function(){"WEEK"===j?f(new Date(g.getFullYear(),g.getMonth(),g.getDate()-7)):f(new Date(g.getFullYear(),g.getMonth()-1,1))},children:"◀"}),(0,s.jsx)("button",{className:"btn",onClick:function(){f(new Date)},children:"Hoje"}),(0,s.jsx)("button",{className:"btn",onClick:function(){"WEEK"===j?f(new Date(g.getFullYear(),g.getMonth(),g.getDate()+7)):f(new Date(g.getFullYear(),g.getMonth()+1,1))},children:"▶"}),(0,s.jsx)("input",{className:"input ml-2",type:"date",value:i(g),onChange:e=>f(new Date(e.target.value+"T00:00:00"))})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsxs)("div",{className:"text-sm text-gray-500",children:["Per\xedodo: ",i(b.start)," → ",i(b.end)]}),(0,s.jsx)("button",{className:"btn",onClick:function(){let e=new Blob([[["Data","Hora","Cliente","Profissional","T\xedtulo","Status","Documento"],...a.map(e=>[i(e.start_datetime),c(e.start_datetime),e.company_nome||"",e.profissional||"",e.title||"",e.status||"",e.cnpj||e.cpf||e.caepf||""])].map(e=>e.map(r).join(",")).join("\n")],{type:"text/csv;charset=utf-8;"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="atividades_".concat(i(b.start),"_").concat(i(b.end),".csv"),s.click(),URL.revokeObjectURL(t)},children:"Exportar CSV"})]})]})]}),"WEEK"===j&&(0,s.jsx)("div",{className:"grid md:grid-cols-7 gap-3",children:v.map((e,t)=>{let a=w[i(e)]||[];return(0,s.jsxs)("div",{className:"card",children:[(0,s.jsx)("div",{className:"font-semibold",children:e.toLocaleDateString("pt-BR",{weekday:"long",day:"2-digit",month:"2-digit"})}),(0,s.jsxs)("ul",{className:"mt-2 space-y-2",children:[a.map(e=>(0,s.jsxs)("li",{className:"border rounded-xl p-2",children:[(0,s.jsx)("div",{className:"text-sm font-medium",children:e.title}),(0,s.jsxs)("div",{className:"text-xs text-gray-500",children:[c(e.start_datetime)," • ",e.company_nome||"—"," • ",e.profissional||"—"]}),(0,s.jsx)("a",{className:"text-xs text-accent",href:"/activities/".concat(e.id),children:"Abrir"})]},e.id)),0===a.length&&(0,s.jsx)("li",{className:"text-xs text-gray-400",children:"Sem atividades"})]})]},t)})}),"MONTH"===j&&(0,s.jsx)("div",{className:"card",children:(0,s.jsxs)("div",{className:"grid grid-cols-7 gap-2",children:[["Seg","Ter","Qua","Qui","Sex","S\xe1b","Dom"].map((e,t)=>(0,s.jsx)("div",{className:"hdr p-2 text-center",children:e},t)),D.map((e,t)=>{let a=i(e),n=(w[a]||[]).slice(0,4),l=e.getMonth()!==g.getMonth();return(0,s.jsxs)("div",{className:"border rounded-xl p-2 min-h-[110px] ".concat(l?"bg-gray-50 text-gray-400":""),children:[(0,s.jsx)("div",{className:"text-xs text-right",children:e.getDate().toString().padStart(2,"0")}),(0,s.jsxs)("ul",{className:"mt-1 space-y-1",children:[n.map(e=>(0,s.jsxs)("li",{className:"text-xs",children:[(0,s.jsx)("span",{className:"font-medium",children:c(e.start_datetime)})," — ",(0,s.jsx)("a",{className:"underline",href:"/activities/".concat(e.id),children:e.title})]},e.id)),0===(w[a]||[]).length&&(0,s.jsx)("li",{className:"text-[11px] text-gray-400",children:"Sem atividades"}),(w[a]||[]).length>4&&(0,s.jsxs)("li",{className:"text-[11px] text-blue-600",children:["+ ",(w[a]||[]).length-4," mais"]})]})]},t)})]})}),"LIST"===j&&(0,s.jsx)("div",{className:"card overflow-auto",children:(0,s.jsxs)("table",{className:"w-full text-sm",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{className:"text-left",children:[(0,s.jsx)("th",{className:"p-2",children:"Data"}),(0,s.jsx)("th",{className:"p-2",children:"Hora"}),(0,s.jsx)("th",{className:"p-2",children:"Cliente"}),(0,s.jsx)("th",{className:"p-2",children:"Profissional"}),(0,s.jsx)("th",{className:"p-2",children:"T\xedtulo"}),(0,s.jsx)("th",{className:"p-2",children:"Status"}),(0,s.jsx)("th",{className:"p-2",children:"Documento"}),(0,s.jsx)("th",{className:"p-2",children:"A\xe7\xe3o"})]})}),(0,s.jsxs)("tbody",{children:[[...a].sort((e,t)=>l(e.start_datetime)-l(t.start_datetime)).map(e=>{let t=i(e.start_datetime),a=c(e.start_datetime);return(0,s.jsxs)("tr",{className:"border-t",children:[(0,s.jsx)("td",{className:"p-2",children:t}),(0,s.jsx)("td",{className:"p-2",children:a}),(0,s.jsx)("td",{className:"p-2",children:e.company_nome||"—"}),(0,s.jsx)("td",{className:"p-2",children:e.profissional||"—"}),(0,s.jsx)("td",{className:"p-2",children:e.title}),(0,s.jsx)("td",{className:"p-2",children:e.status}),(0,s.jsx)("td",{className:"p-2",children:e.cnpj||e.cpf||e.caepf||"—"}),(0,s.jsx)("td",{className:"p-2",children:(0,s.jsx)("a",{className:"text-accent underline",href:"/activities/".concat(e.id),children:"Abrir"})})]},e.id)}),0===a.length&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{className:"p-2 text-gray-500",colSpan:8,children:"Sem atividades no per\xedodo."})})]})]})})]})}}},function(e){e.O(0,[971,23,744],function(){return e(e.s=3123)}),_N_E=e.O()}]);