(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[628],{7706:function(e,s,t){Promise.resolve().then(t.bind(t,4309))},4309:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return n}});var a=t(7437),i=t(2265);function n(){let[e,s]=(0,i.useState)([]),[t,n]=(0,i.useState)([]),[c,l]=(0,i.useState)([]),[r,d]=(0,i.useState)({company_id:"",description:"",value:"",items:[{service_id:"",qty:1,price:"",due_date:""}]});async function o(){let[e,t,a]=await Promise.all([fetch("/api/companies").then(e=>e.json()),fetch("/api/services").then(e=>e.json()),fetch("/api/proposals").then(e=>e.json())]);s(e),n(t),l(a)}function u(e,s,t){let a=[...r.items];a[e][s]=t,d({...r,items:a})}async function p(e){e.preventDefault(),await fetch("/api/proposals",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),d({company_id:"",description:"",value:"",items:[{service_id:"",qty:1,price:"",due_date:""}]}),o()}async function h(e){await fetch("/api/proposals/"+e,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"APROVADA"})}),o()}return(0,i.useEffect)(()=>{o()},[]),(0,a.jsxs)("div",{className:"space-y-4",children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold",children:"Propostas"}),(0,a.jsx)("div",{className:"card",children:(0,a.jsxs)("form",{onSubmit:p,className:"space-y-3",children:[(0,a.jsxs)("div",{className:"grid md:grid-cols-3 gap-3",children:[(0,a.jsxs)("select",{className:"select",value:r.company_id,onChange:e=>d({...r,company_id:e.target.value}),required:!0,children:[(0,a.jsx)("option",{value:"",children:"Empresa"}),e.map(e=>(0,a.jsx)("option",{value:e.id,children:e.nome},e.id))]}),(0,a.jsx)("input",{className:"input",placeholder:"Valor total (R$)",value:r.value,onChange:e=>d({...r,value:e.target.value})}),(0,a.jsx)("input",{className:"input",placeholder:"Descri\xe7\xe3o",value:r.description,onChange:e=>d({...r,description:e.target.value})})]}),(0,a.jsxs)("div",{className:"space-y-2",children:[(0,a.jsx)("div",{className:"text-sm font-medium",children:"Itens"}),r.items.map((e,s)=>(0,a.jsxs)("div",{className:"grid md:grid-cols-4 gap-2",children:[(0,a.jsxs)("select",{className:"select",value:e.service_id,onChange:e=>u(s,"service_id",e.target.value),required:!0,children:[(0,a.jsx)("option",{value:"",children:"Servi\xe7o"}),t.map(e=>(0,a.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,a.jsx)("input",{className:"input",type:"number",min:"1",value:e.qty,onChange:e=>u(s,"qty",e.target.value)}),(0,a.jsx)("input",{className:"input",placeholder:"Pre\xe7o (R$)",value:e.price,onChange:e=>u(s,"price",e.target.value)}),(0,a.jsx)("input",{className:"input",type:"date",value:e.due_date||"",onChange:e=>u(s,"due_date",e.target.value)})]},s)),(0,a.jsx)("button",{type:"button",className:"btn",onClick:function(){d({...r,items:[...r.items,{service_id:"",qty:1,price:"",due_date:""}]})},children:"+ Item"})]}),(0,a.jsx)("div",{children:(0,a.jsx)("button",{className:"btn",children:"Salvar Proposta"})})]})}),(0,a.jsx)("div",{className:"card overflow-auto",children:(0,a.jsxs)("table",{className:"w-full text-sm",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{children:"ID"}),(0,a.jsx)("th",{children:"Empresa"}),(0,a.jsx)("th",{children:"Valor"}),(0,a.jsx)("th",{children:"Status"}),(0,a.jsx)("th",{children:"Emitida"}),(0,a.jsx)("th",{children:"A\xe7\xf5es"})]})}),(0,a.jsx)("tbody",{children:c.map(e=>(0,a.jsxs)("tr",{className:"border-t",children:[(0,a.jsx)("td",{children:e.id}),(0,a.jsx)("td",{children:e.company_nome}),(0,a.jsxs)("td",{children:["R$ ",Number(e.value).toFixed(2)]}),(0,a.jsx)("td",{children:e.status}),(0,a.jsx)("td",{children:new Date(e.issued_at).toLocaleString("pt-BR")}),(0,a.jsx)("td",{children:"APROVADA"!==e.status&&(0,a.jsx)("button",{className:"btn",onClick:()=>h(e.id),children:"Aprovar"})})]},e.id))})]})})]})}}},function(e){e.O(0,[971,23,744],function(){return e(e.s=7706)}),_N_E=e.O()}]);